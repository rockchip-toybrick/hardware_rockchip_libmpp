# vim: syntax=cmake
INCLUDE_DIRECTORIES(.)

add_definitions(-DUSE_RING_BUF)
add_definitions(-DHAVE_H264E)
add_definitions(-DHAVE_H265E)
add_definitions(-DRKVEPU510_H264)
add_definitions(-DRKVEPU510_HEVC)
add_definitions(-DRKVEPU511_H264)
add_definitions(-DRKVEPU511_HEVC)

INCLUDE_DIRECTORIES(${KMPP_TOP}/include)
INCLUDE_DIRECTORIES(${KMPP_TOP}/osal)
INCLUDE_DIRECTORIES(${KMPP_TOP}/osal/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/sys)
INCLUDE_DIRECTORIES(${KMPP_TOP}/sys/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/mpp_osal)
INCLUDE_DIRECTORIES(${KMPP_TOP}/mpp_service)
INCLUDE_DIRECTORIES(${KMPP_TOP}/mpp_service/hack)
INCLUDE_DIRECTORIES(${KMPP_TOP}/kmpp/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/kmpp/objs/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/kmpp/vsp/inc)

# kmpp header
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/osal/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/base/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/codec)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/codec/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/codec/rc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/codec/enc/h264e)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/codec/enc/h265e)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/codec/enc/jpeg)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/common)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/inc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/common)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/common/h264)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/common/h265)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/common/jpeg)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/rkenc/common)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/rkenc/h264e)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/rkenc/h265e)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vcodec/mpp/hal/rkenc/jpege)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vproc)
INCLUDE_DIRECTORIES(${KMPP_TOP}/vproc/pp)
INCLUDE_DIRECTORIES(${KMPP_TOP}/mpp)

SET(KMPP_SRC
    ../dvbm/rockchip_dvbm.c
    ../vproc/pp/vepu500_pp.c
    #../vproc/pp/vepu_pp.c
    ../vproc/pp/vepu_pp_service.c
    #../mpp/mpp_iommu.c
    #../mpp/mpp_service.c
    ../mpp/mpp_common.c
    #../mpp/mpp_rkvenc_540c.c
    ../mpp/mpp_rkvenc_500.c
    ../mpp/mpp_rkvenc_pp.c
    ../vcodec/mpp/hal/mpp_enc_hal.c
    ../vcodec/mpp/hal/rkenc/h264e/hal_h264e_scaling_list.c
    #../vcodec/mpp/hal/rkenc/h264e/hal_h264e_vepu580.c
    ../vcodec/mpp/hal/rkenc/h264e/hal_h264e_vepu510.c
    ../vcodec/mpp/hal/rkenc/h264e/hal_h264e_vepu511.c
    #../vcodec/mpp/hal/rkenc/h264e/hal_h264e_vepu540c.c
    ../vcodec/mpp/hal/rkenc/common/vepu510_common.c
    ../vcodec/mpp/hal/rkenc/common/vepu511_common.c
    ../vcodec/mpp/hal/rkenc/common/vepu5xx_common.c
    ../vcodec/mpp/hal/rkenc/common/vepu540c_common.c
    ../vcodec/mpp/hal/rkenc/common/vepu500_common.c
    #../vcodec/mpp/hal/rkenc/h265e/hal_h265e_vepu580.c
    ../vcodec/mpp/hal/rkenc/h265e/hal_h265e_vepu510.c
    ../vcodec/mpp/hal/rkenc/h265e/hal_h265e_vepu511.c
    #../vcodec/mpp/hal/rkenc/h265e/hal_h265e_vepu541.c
    ../vcodec/mpp/hal/rkenc/h265e/hal_h265e_scaling_list.c
    #../vcodec/mpp/hal/rkenc/h265e/hal_h265e_vepu540c.c
    #../vcodec/mpp/hal/rkenc/jpege/hal_jpege_vepu540c.c
    #../vcodec/mpp/hal/rkenc/jpege/hal_jpege_vepu500.c
    ../vcodec/mpp/hal/rkenc/jpege/hal_jpege_vepu511.c
    ../vcodec/mpp/hal/rkenc/jpege/hal_jpege_vpu720.c
    ../vcodec/mpp/hal/common/h264/hal_h264e_api_v2.c
    ../vcodec/mpp/hal/common/h265/hal_h265e_api_v2.c
    ../vcodec/mpp/hal/common/hal_bufs.c
    ../vcodec/mpp/hal/common/jpeg/hal_jpege_api_v2.c
    ../vcodec/mpp/hal/common/jpeg/hal_jpege_hdr.c
    ../vcodec/mpp/base/mpp_enc_refs.c
    ../vcodec/mpp/base/mpp_trie.c
    ../vcodec/mpp/base/mpp_enc_cfg.c
    ../vcodec/mpp/base/mpp_packet.c
    ../vcodec/mpp/base/mpp_bitwrite.c
    ../vcodec/mpp/base/mpp_enc_ref.c
    ../vcodec/mpp/base/mpp_enc_refs_setup.c
    ../vcodec/mpp/base/mpp_buffer.c
    ../vcodec/mpp/base/mpp_stream_ring_buf.c
    ../vcodec/mpp/base/mpp_bitread.c
    ../vcodec/mpp/base/mpp_cfg.c
    ../vcodec/mpp/base/mpp_2str.c
    ../vcodec/mpp/codec/enc_impl.c
    ../vcodec/mpp/codec/mpp_enc.c
    ../vcodec/mpp/codec/rc/mpp_rc.c
    ../vcodec/mpp/codec/rc/h265e_rc.c
    ../vcodec/mpp/codec/rc/rc.c
    ../vcodec/mpp/codec/rc/h264e_rc.c
    ../vcodec/mpp/codec/rc/jpege_rc.c
    ../vcodec/mpp/codec/rc/rc_model_v2.c
    ../vcodec/mpp/codec/rc/rc_model_v2_smt.c
    ../vcodec/mpp/codec/rc/rc_base.c
    ../vcodec/mpp/codec/enc/h264e/h264e_pps.c
    ../vcodec/mpp/codec/enc/h264e/h264e_api_v2.c
    ../vcodec/mpp/codec/enc/h264e/h264e_dpb.c
    ../vcodec/mpp/codec/enc/h264e/h264e_sps.c
    ../vcodec/mpp/codec/enc/h264e/h264e_sei.c
    ../vcodec/mpp/codec/enc/h264e/h264e_slice.c
    ../vcodec/mpp/codec/enc/jpeg/jpege_api_v2.c
    ../vcodec/mpp/codec/enc/h265e/h265e_ps.c
    ../vcodec/mpp/codec/enc/h265e/h265e_api.c
    ../vcodec/mpp/codec/enc/h265e/h265e_dpb.c
    ../vcodec/mpp/codec/enc/h265e/h265e_header_gen.c
    ../vcodec/mpp/codec/enc/h265e/h265e_enctropy.c
    ../vcodec/mpp/codec/enc/h265e/h265e_stream.c
    ../vcodec/mpp/codec/enc/h265e/h265e_syntax.c
    ../vcodec/mpp/codec/enc/h265e/h265e_slice.c
    ../vcodec/mpp/codec/mpp_enc_impl.c
    ../vcodec/mpp_vcodec_event.c
    ../vcodec/mpp_vcodec_chan.c
    ../vcodec/mpp_vcodec_flow.c
    ../vcodec/mpp_vcodec_driver.c
    ../vcodec/mpp_vcodec_base.c
    ../vcodec/osal/mpp_log.c
    ../vcodec/osal/mpp_time.c
    ../vcodec/osal/osal_mpp_service.c
    ../vcodec/osal/mpp_device.c
    ../vcodec/osal/mpp_maths.c
    ../vcodec/osal/mpp_mem.c
    ../vcodec/mpp_vcodec_thread.c
    ../vcodec/kmpi/kmpi_venc.c
    ../vcodec/kmpi/kmpi_venc_chan.c
    #mpp_av1dec.c
    mpp_iep2.c
    mpp_jpgdec.c
    mpp_jpgenc.c
    mpp_rkvdec2.c
    mpp_rkvdec2_link.c
    mpp_rkvdec.c
    mpp_rkvenc2.c
    mpp_rkvenc.c
    mpp_vdpp.c
    mpp_vdpu1.c
    mpp_vdpu2.c
    mpp_vepu1.c
    mpp_vepu2.c
    mpp_iommu.c
    mpp_service.c
    mpp_common.c
    ../mpp_osal/mpp_osal.c
    hack/mpp_hack_px30.c
    hack/mpp_hack_rk3576.c
    hack/mpp_rkvdec2_hack_rk3568.c
    hack/mpp_rkvdec2_link_hack_rk3568.c
    ../kmpp/objs/kmpp_frame.c
    ../kmpp/objs/kmpp_meta.c
    ../kmpp/objs/kmpp_venc_objs.c
    ../kmpp/objs/kmpp_vsp_objs.c
    ../kmpp/vsp/kmpi_vsp.c
    ../kmpp/vsp/kmpp_vsp.c
)

IF(${BUILD_MULTI_KO})
    ADD_KBUILD(kmpp SRC ${KMPP_SRC} DEPS osal sys)
ELSE()
    ADD_KMPP_SRC(${KMPP_SRC})
    GET_PROPERTY(ko_src GLOBAL PROPERTY "KMPP_KO_SRC")
    ADD_KBUILD(kmpp SRC ${ko_src})
ENDIF()
